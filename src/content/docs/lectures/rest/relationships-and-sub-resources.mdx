---
title: Relationships and Sub-Resources
description: Resource-oriented design
sidebar:
    label: "Sub Resources"
    order: 3
---

## Understanding Resource Relationships

In real-world applications, resources rarely exist in isolation. They form complex webs of relationships that mirror the domain model. A well-designed REST API must effectively represent these relationships while maintaining clean, intuitive URI structures and providing clear navigation paths for clients.

Resource relationships in REST APIs serve multiple purposes:
- **Data integrity**: Ensure related resources maintain consistent state
- **Navigation**: Enable clients to discover and traverse related resources
- **Business logic**: Reflect real-world constraints and dependencies
- **Performance**: Optimize data access patterns

## Types of Resource Relationships

### 1. One-to-Many (1:N) Relationships

The most common relationship type where one parent resource owns or contains multiple child resources.

**Examples:**
- A research expedition has many collected samples
- A galaxy contains many star systems
- A lab has many experiments

**URI Patterns:**
```http
GET /expeditions/EXP-MARS-2159/samples
POST /expeditions/EXP-MARS-2159/samples
GET /expeditions/EXP-MARS-2159/samples/SAMPLE-001
```

### 2. Many-to-Many (N:M) Relationships

Complex relationships where resources can be associated with multiple other resources.

**Examples:**
- Scientists collaborate on multiple research projects
- Chemical compounds participate in multiple reactions
- Genes are expressed in multiple tissues

**URI Patterns:**
```http
GET /scientists/SCI-CURIE-001/projects
GET /projects/PROJ-GENETICS-2159/scientists
POST /projects/PROJ-GENETICS-2159/scientists
```

### 3. One-to-One (1:1) Relationships

Specialized relationships where resources have exclusive associations.

**Examples:**
- Each spacecraft has one navigation system
- Each experiment has one primary researcher
- Each planet has one orbital data record

**URI Patterns:**
```http
GET /spacecraft/CRAFT-VOYAGER-3/navigation-system
PUT /spacecraft/CRAFT-VOYAGER-3/navigation-system
```

## Relationship Design Patterns

### Sub-Resources (Nested Resources)

Use sub-resources when child resources are **existentially dependent** on their parent or when representing strong ownership relationships.

#### When to Use Sub-Resources

1. **Existential Dependency**: Child cannot exist without parent
2. **Composition Relationship**: Child is part of the parent
3. **Strong Ownership**: Parent owns and manages child lifecycle

#### Example: Research Expedition Samples

```http
# Get all samples from an expedition
GET /astrobiology/v1/expeditions/EXP-EUROPA-2159/samples

# Create a new sample for the expedition
POST /astrobiology/v1/expeditions/EXP-EUROPA-2159/samples
Content-Type: application/json

{
  "sample_type": "ice_core",
  "location": {
    "latitude": -15.2,
    "longitude": 181.4,
    "depth_meters": 2.5
  },
  "collection_method": "drill_extraction"
}

# Get specific sample
GET /astrobiology/v1/expeditions/EXP-EUROPA-2159/samples/SAMPLE-ICE-001
```

**Response Example:**
```json
{
  "_links": {
    "self": { "href": "{baseurl}/expeditions/EXP-EUROPA-2159/samples/SAMPLE-ICE-001" },
    "parent": { "href": "{baseurl}/expeditions/EXP-EUROPA-2159" },
    "collection": { "href": "{baseurl}/expeditions/EXP-EUROPA-2159/samples" },
    "analysis": { "href": "{baseurl}/expeditions/EXP-EUROPA-2159/samples/SAMPLE-ICE-001/analysis" }
  },
  "id": "SAMPLE-ICE-001",
  "expedition_id": "EXP-EUROPA-2159",
  "sample_type": "ice_core",
  "location": {
    "latitude": -15.2,
    "longitude": 181.4,
    "depth_meters": 2.5
  },
  "collection_method": "drill_extraction",
  "collected_at": "2159-04-15T14:30:00Z",
  "status": "analyzing"
}
```

### Reference Links (Association Resources)

Use reference links when resources have **loose coupling** or when the relationship is more of an association than ownership.

#### When to Use Reference Links

1. **Independent Existence**: Both resources can exist independently
2. **Weak Association**: Relationship can change over time
3. **Cross-Domain References**: Resources belong to different bounded contexts

#### Example: Scientist-Project Association

Instead of making projects sub-resources of scientists, use associations:

```http
# Get scientist's current projects
GET /research/v1/scientists/SCI-WATSON-042/projects

# Associate scientist with project
POST /research/v1/scientists/SCI-WATSON-042/projects
Content-Type: application/json

{
  "project_id": "PROJ-DNA-ANALYSIS-2159",
  "role": "lead_researcher",
  "start_date": "2159-01-15"
}

# Get project details (independent resource)
GET /research/v1/projects/PROJ-DNA-ANALYSIS-2159
```

**Response with Association:**
```json
{
  "_links": {
    "self": { "href": "{baseurl}/scientists/SCI-WATSON-042/projects" },
    "scientist": { "href": "{baseurl}/scientists/SCI-WATSON-042" }
  },
  "projects": [
    {
      "_links": {
        "project": { "href": "{baseurl}/projects/PROJ-DNA-ANALYSIS-2159" },
        "remove": { 
          "href": "{baseurl}/scientists/SCI-WATSON-042/projects/PROJ-DNA-ANALYSIS-2159",
          "method": "DELETE"
        }
      },
      "project_id": "PROJ-DNA-ANALYSIS-2159",
      "project_title": "Martian DNA Sequencing Analysis",
      "role": "lead_researcher",
      "start_date": "2159-01-15",
      "status": "active"
    }
  ]
}
```

## Complex Relationship Examples

### Scientific Equipment and Experiments

```http
# Equipment can be used in multiple experiments
GET /laboratory/v1/equipment/SPEC-MASS-001/experiments

# Experiments can use multiple pieces of equipment  
GET /laboratory/v1/experiments/EXP-PROTEIN-2159/equipment

# Book equipment for an experiment
POST /laboratory/v1/experiments/EXP-PROTEIN-2159/equipment
{
  "equipment_id": "SPEC-MASS-001",
  "reserved_from": "2159-03-01T09:00:00Z",
  "reserved_until": "2159-03-01T17:00:00Z",
  "purpose": "protein_mass_analysis"
}
```

### Hierarchical Scientific Classification

```http
# Navigate taxonomic hierarchy
GET /taxonomy/v1/kingdoms/ANIMALIA/phylums
GET /taxonomy/v1/phylums/CHORDATA/classes  
GET /taxonomy/v1/classes/MAMMALIA/orders
GET /taxonomy/v1/orders/PRIMATES/families

# Get species within a family
GET /taxonomy/v1/families/HOMINIDAE/species
```

**Hierarchical Response:**
```json
{
  "_links": {
    "self": { "href": "{baseurl}/families/HOMINIDAE/species" },
    "parent": { "href": "{baseurl}/orders/PRIMATES/families/HOMINIDAE" },
    "order": { "href": "{baseurl}/orders/PRIMATES" }
  },
  "family": "Hominidae",
  "species_count": 8,
  "_embedded": {
    "species": [
      {
        "_links": {
          "self": { "href": "{baseurl}/species/HOMO-SAPIENS" },
          "subspecies": { "href": "{baseurl}/species/HOMO-SAPIENS/subspecies" }
        },
        "id": "HOMO-SAPIENS",
        "scientific_name": "Homo sapiens",
        "common_name": "Human",
        "conservation_status": "least_concern"
      }
    ]
  }
}
```

## Hypermedia and HATEOAS

Effective relationship design relies heavily on hypermedia to guide clients through resource relationships.

### Essential Link Relations

Every resource response should include:

1. **self**: Link to the resource itself
2. **parent**: Link to parent resource (for sub-resources)  
3. **collection**: Link to the collection containing this resource
4. **related**: Links to associated resources
5. **actions**: Links for available operations

### Example: Comprehensive Hypermedia

```json
{
  "_links": {
    "self": { "href": "{baseurl}/experiments/EXP-GENOME-2159" },
    "collection": { "href": "{baseurl}/experiments" },
    "lead_scientist": { "href": "{baseurl}/scientists/SCI-MENDEL-001" },
    "laboratory": { "href": "{baseurl}/laboratories/LAB-GENETICS-ALPHA" },
    "samples": { "href": "{baseurl}/experiments/EXP-GENOME-2159/samples" },
    "results": { "href": "{baseurl}/experiments/EXP-GENOME-2159/results" },
    "equipment": { "href": "{baseurl}/experiments/EXP-GENOME-2159/equipment" },
    "edit": { 
      "href": "{baseurl}/experiments/EXP-GENOME-2159",
      "method": "PUT"
    },
    "start": {
      "href": "{baseurl}/experiments/EXP-GENOME-2159/start",
      "method": "POST"
    }
  },
  "id": "EXP-GENOME-2159",
  "title": "CRISPR Gene Expression Analysis",
  "status": "preparing",
  "lead_scientist_id": "SCI-MENDEL-001",
  "laboratory_id": "LAB-GENETICS-ALPHA",
  "created_at": "2159-02-01T10:00:00Z",
  "estimated_duration_days": 14
}
```

## Best Practices for Resource Relationships

### 1. Limit URI Depth
```http
# Good: Single level of nesting
GET /expeditions/EXP-001/samples

# Avoid: Deep nesting becomes unwieldy
GET /expeditions/EXP-001/samples/SAMPLE-001/analysis/results/charts
```

### 2. Provide Multiple Access Patterns
```http
# Access experiment samples via experiment
GET /experiments/EXP-001/samples

# Access samples directly when you know the ID
GET /samples/SAMPLE-001

# Access all samples with filtering
GET /samples?experiment_id=EXP-001
```

### 3. Use Consistent Relationship Patterns
- Always use the same relationship pattern for similar associations
- Document your relationship conventions clearly
- Be consistent across your entire API

### 4. Handle Cascade Operations Carefully
```http
# Explicit cascade deletion
DELETE /expeditions/EXP-001?cascade=samples

# Safe default: prevent deletion with dependencies
DELETE /expeditions/EXP-001
# Returns 409 Conflict if samples exist
```

### 5. Optimize for Common Use Cases
Design your relationship structure around the most frequent access patterns in your domain.



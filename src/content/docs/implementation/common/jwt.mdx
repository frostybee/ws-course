---
title: Working with JSON Web Tokens
description: Working with JSON Web Tokens
draft: false
sidebar:
    label: " JSON Web Tokens"
    order: 2
    badge:
      text: Team Project
      variant: danger
---

import LinkOut from '../../../../components/LinkOut.astro'
import { Aside } from '@astrojs/starlight/components';

## What is a JSON Web Token (JWT)?

A **<LinkOut href='https://jwt.io/'>JSON Web Token</LinkOut>** (JWT) is an open, industry-standard (<LinkOut href='https://datatracker.ietf.org/doc/html/rfc7519'>RFC 7519</LinkOut>) method for securely transmitting information between parties as a JSON object. This information is digitally signed, making it both verifiable and trustworthy. JWTs are commonly used for **authentication** and secure data exchange in web applications.

---

## Characteristics of JWTs

- JWTs contain all the information needed for authentication and authorization in the payload, eliminating the need for a database lookup.
- They are URI-safe and can easily be transmitted via HTTP headers or query strings.
- There is no need to store session information on the server, making JWTs suitable for distributed systems or microservices.
- The signature ensures that the token is valid and untampered.
- JWTs can include custom claims, allowing developers to store application-specific information.


---

## Structure of a JWT

A JWT consists of **three parts**:  
1. **Header**: Contains metadata about the token, such as the signing algorithm (e.g., HMAC HS256, RSA).
2. **Payload**: Contains the claims, such as user information and permissions.
3. **Signature**: Ensures the token's integrity by validating that it was not tampered with.


These parts are concatenated together with periods (`.`), forming a string like this:
```
<Header>.<Payload>.<Signature>
```

### 1. Header
The header typically consists of two parts:
- **`alg`**: The signing algorithm used, such as HMAC SHA256 or RSA.
- **`typ`**: (optional) The type of the token. It is usually `JWT`.

For example, a header might look like this:

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

When encoded in Base64Url, this becomes a string (part of the JWT).

### 2. Payload
The payload contains the **claims** (pieces of information). Claims are statements about an entity (typically the user) and additional metadata. There are **three types** of claims:

1. **Registered claims**: Predefined claims that are not mandatory but recommended for interoperability. Some common registered claims include:
    - **`sub`** (Subject): Identifies the principal that is the subject of the JWT (e.g., the user ID).
    - **`iss`** (Issuer): Identifies the issuer of the JWT.
    - **`aud`** (Audience): Identifies the audience for which the JWT is intended.
    - **`iat`** (Issued At): When the token was issued.
    - **`exp`** (Expiration Time): The expiration time after which the JWT should no longer be accepted.
    - **`nbf`** (not before): When the token becomes valid.
    <LinkOut href='https://www.unixtimestamp.com/'>Unix Timestamp Converter</LinkOut>
    
2. **Public claims**: Claims that can be defined at will by the user or system, but to avoid collisions, they should be defined in a way that is collision-resistant, often using a URI namespace.

3. **Private claims**: Custom claims created for use by parties who agree on them, e.g., user roles or permissions.

Example of a payload (claims):

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022,
  "exp": 2546539831,
  "role": "admin"
}
```

This payload, when Base64Url encoded, forms the second part of the JWT string.

### 3. Signature
To ensure the integrity of the token and verify its authenticity, the third part of a JWT is the **signature**. To generate the signature, the following process is typically followed:
1. Take the encoded header and the encoded payload.
2. Concatenate them with a period (`.`) separator.
3. Use a secret key (HMAC SHA256) or a private key (RSA or ECDSA) and the signing algorithm (as specified in the header) to create the signature.

For example, if you're using the HMAC SHA256 algorithm, the signature is generated like this:

```text
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```

The result of this operation is the **signature** that is the third part of the JWT. It ensures that the token has not been tampered with. If someone tries to alter the payload or header, the signature will not match when the token is verified.

---

### Example of a Complete JWT

Putting it all together, a JWT might look like this:

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwibWFya2V0Ijp0cnVlfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```
---

## How JWTs Work in Authentication

JWTs are typically used for authentication and authorization. Here's how the flow works:

<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" style="max-width: 100%; height: auto; margin: 2rem 0;">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4a5568" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
    <style>
      {`
        @keyframes fadeInOut1 {
          0%, 4% { opacity: 0; }
          8%, 100% { opacity: 1; }
        }
        @keyframes drawLine1 {
          0%, 2% { stroke-dashoffset: 390; }
          10%, 100% { stroke-dashoffset: 0; }
        }
        @keyframes fadeInOut2 {
          0%, 12% { opacity: 0; }
          16%, 100% { opacity: 1; }
        }
        @keyframes pulseLoop2 {
          0%, 12% { opacity: 0; }
          16%, 18% { opacity: 1; }
          19% { opacity: 0.4; }
          20%, 21% { opacity: 1; }
          22% { opacity: 0.4; }
          23%, 100% { opacity: 1; }
        }
        @keyframes fadeInOut3 {
          0%, 25% { opacity: 0; }
          29%, 100% { opacity: 1; }
        }
        @keyframes drawLine3 {
          0%, 27% { stroke-dashoffset: 390; }
          35%, 100% { stroke-dashoffset: 0; }
        }
        @keyframes fadeInOut4 {
          0%, 37% { opacity: 0; }
          41%, 100% { opacity: 1; }
        }
        @keyframes pulseLoop4 {
          0%, 37% { opacity: 0; }
          41%, 43% { opacity: 1; }
          44% { opacity: 0.4; }
          45%, 46% { opacity: 1; }
          47% { opacity: 0.4; }
          48%, 100% { opacity: 1; }
        }
        @keyframes fadeInOut5 {
          0%, 50% { opacity: 0; }
          54%, 100% { opacity: 1; }
        }
        @keyframes drawLine5 {
          0%, 52% { stroke-dashoffset: 390; }
          60%, 100% { stroke-dashoffset: 0; }
        }
        @keyframes fadeInOut6 {
          0%, 62% { opacity: 0; }
          66%, 100% { opacity: 1; }
        }
        @keyframes pulseLoop6 {
          0%, 62% { opacity: 0; }
          66%, 68% { opacity: 1; }
          69% { opacity: 0.4; }
          70%, 71% { opacity: 1; }
          72% { opacity: 0.4; }
          73%, 100% { opacity: 1; }
        }
        @keyframes fadeInOut7 {
          0%, 75% { opacity: 0; }
          79%, 100% { opacity: 1; }
        }
        @keyframes drawLine7 {
          0%, 77% { stroke-dashoffset: 390; }
          85%, 100% { stroke-dashoffset: 0; }
        }

        .step1 { animation: fadeInOut1 10s ease-in infinite; opacity: 0; }
        .step1-line {
          stroke-dasharray: 390;
          stroke-dashoffset: 390;
          animation: drawLine1 10s ease-out infinite;
        }
        .step2 { animation: fadeInOut2 10s ease-in infinite; opacity: 0; }
        .step2-pulse { animation: pulseLoop2 10s ease-in-out infinite; }
        .step3 { animation: fadeInOut3 10s ease-in infinite; opacity: 0; }
        .step3-line {
          stroke-dasharray: 390;
          stroke-dashoffset: 390;
          animation: drawLine3 10s ease-out infinite;
        }
        .step4 { animation: fadeInOut4 10s ease-in infinite; opacity: 0; }
        .step4-pulse { animation: pulseLoop4 10s ease-in-out infinite; }
        .step5 { animation: fadeInOut5 10s ease-in infinite; opacity: 0; }
        .step5-line {
          stroke-dasharray: 390;
          stroke-dashoffset: 390;
          animation: drawLine5 10s ease-out infinite;
        }
        .step6 { animation: fadeInOut6 10s ease-in infinite; opacity: 0; }
        .step6-pulse { animation: pulseLoop6 10s ease-in-out infinite; }
        .step7 { animation: fadeInOut7 10s ease-in infinite; opacity: 0; }
        .step7-line {
          stroke-dasharray: 390;
          stroke-dashoffset: 390;
          animation: drawLine7 10s ease-out infinite;
        }
      `}
    </style>
  </defs>

  {/* Client Box */}
  <rect x="50" y="50" width="150" height="80" fill="#e6f3ff" stroke="#3b82f6" stroke-width="2" rx="8"/>
  <text x="125" y="95" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e40af">Client</text>

  {/* Server Box */}
  <rect x="600" y="50" width="150" height="80" fill="#fef3e6" stroke="#f59e0b" stroke-width="2" rx="8"/>
  <text x="675" y="95" text-anchor="middle" font-size="18" font-weight="bold" fill="#b45309">Server</text>

  {/* Step 1: Login Request */}
  <g class="step1">
    <line class="step1-line" x1="200" y1="170" x2="590" y2="170" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="395" y="160" text-anchor="middle" font-size="14" fill="#1f2937">1. POST /login</text>
    <text x="395" y="185" text-anchor="middle" font-size="12" fill="#6b7280">(username, password)</text>
  </g>

  {/* Step 2-3: Verify & Generate */}
  <g class="step2">
    <rect class="step2-pulse" x="620" y="210" width="110" height="60" fill="#fff7ed" stroke="#fb923c" stroke-width="1" rx="4" stroke-dasharray="4,4"/>
    <text x="675" y="235" text-anchor="middle" font-size="12" fill="#9a3412">2. Verify credentials</text>
    <text x="675" y="255" text-anchor="middle" font-size="12" fill="#9a3412">3. Generate JWT</text>
  </g>

  {/* Step 4: Return JWT */}
  <g class="step3">
    <line class="step3-line" x1="590" y1="310" x2="200" y2="310" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
    <text x="395" y="300" text-anchor="middle" font-size="14" fill="#1f2937">4. JWT Token</text>
    <text x="395" y="325" text-anchor="middle" font-size="11" fill="#059669">eyJhbGci...</text>
  </g>

  {/* Step 5: Store Token */}
  <g class="step4">
    <rect class="step4-pulse" x="70" y="350" width="110" height="40" fill="#f0f9ff" stroke="#3b82f6" stroke-width="1" rx="4" stroke-dasharray="4,4"/>
    <text x="125" y="375" text-anchor="middle" font-size="12" fill="#1e40af">5. Store token</text>
  </g>

  {/* Step 6: Request with JWT */}
  <g class="step5">
    <line class="step5-line" x1="200" y1="440" x2="590" y2="440" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="395" y="430" text-anchor="middle" font-size="14" fill="#1f2937">6. GET /api/resource</text>
    <text x="395" y="455" text-anchor="middle" font-size="11" fill="#6b7280">Authorization: Bearer &lt;token&gt;</text>
  </g>

  {/* Step 7-8: Verify JWT */}
  <g class="step6">
    <rect class="step6-pulse" x="620" y="480" width="110" height="60" fill="#fff7ed" stroke="#fb923c" stroke-width="1" rx="4" stroke-dasharray="4,4"/>
    <text x="675" y="505" text-anchor="middle" font-size="12" fill="#9a3412">7. Verify signature</text>
    <text x="675" y="525" text-anchor="middle" font-size="12" fill="#9a3412">8. Check expiration</text>
  </g>

  {/* Step 9: Return Data */}
  <g class="step7">
    <line class="step7-line" x1="590" y1="565" x2="200" y2="565" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead-green)"/>
    <text x="395" y="555" text-anchor="middle" font-size="14" fill="#1f2937">9. Protected resource</text>
    <text x="395" y="580" text-anchor="middle" font-size="11" fill="#059669">Success: 200 OK</text>
  </g>
</svg>

```
Client                                Server
  |                                     |
  | 1. POST /login (credentials)        |
  |------------------------------------>|
  |                                     |
  |                                     | 2. Verify credentials
  |                                     | 3. Generate JWT
  |                                     |
  | 4. JWT token                        |
  |<------------------------------------|
  |                                     |
  | Store token for future requests     |
  |                                     |
  | 5. GET /api/resource                |
  |    Authorization: Bearer <token>    |
  |    (JWT REQUIRED!)                  |
  |------------------------------------>|
  |                                     |
  |                                     | 6. Verify JWT signature
  |                                     | 7. Check expiration
  |                                     | 8. If invalid/missing: 401 Unauthorized
  |                                     |
  | 9. Protected resource data          |
  |<------------------------------------|
  |                                     |
```

1. The client sends its credentials (usually a username and password) to the server.
2. The server verifies the credentials, and if valid, generates a JWT signed with a secret key or a private key (depending on the algorithm used).
3. The server sends the JWT back to the client. The client stores the token, typically in local storage or an HTTP-only cookie.
4. For any subsequent requests to protected routes, the client **must** include the JWT in the `Authorization` header using the Bearer schema:
     ```
     Authorization: Bearer <token>
     ```
     Without this token, the server will reject the request and deny access to protected resources.
5. The server verifies the token's authenticity and ensures it hasn't expired. If valid, the server allows access to the requested resource.

---

## Debugging and Monitoring
:::note
- **Decode Tokens**: Use tools like **<LinkOut href='https://jwt.io/'>jwt.io</LinkOut>** to decode and inspect tokens.
- **Log Failures**: Log all failed authentication attempts for monitoring and auditing.
:::

---

## Use Cases

### 1. Authentication
The most common use of JWTs is for **user authentication**. After a user logs in, a JWT is generated and sent to the client (e.g., a web browser or mobile app). The client then sends this token in the `Authorization` header on subsequent requests, typically using the `Bearer` schema:
```
Authorization: Bearer <JWT>
```
This allows the server to authenticate the user by verifying the token's signature and checking the claims (e.g., expiration time, issuer).

### 2. Authorization
JWTs are also commonly used to carry **authorization information**. For example, the payload might include **roles** or **permissions** granted to the user. The server can use this information to authorize actions, such as allowing a user with an "admin" role to access an admin panel.

### 3. Information Exchange
Since JWTs can carry any kind of information (provided it's signed), they are often used for securely transmitting data between parties. The signature ensures that the data has not been tampered with in transit.
